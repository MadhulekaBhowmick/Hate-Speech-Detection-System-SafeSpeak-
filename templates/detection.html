<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SafeSpeak â€” Detection</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <section class="detection-section">
    <div class="detection-container">
      <h2>Detect Hate/Offensive Language</h2>
      <textarea id="input-textarea" rows="6" placeholder="Paste text here..."></textarea>
      <button onclick="detectSpeech()">Detect</button>
      <div id="result"></div>
      <div id="probs"></div>
    </div>
  </section>

  <script>
    function detectSpeech() {
      const inputText = document.getElementById("input-textarea").value.trim();
      const result = document.getElementById("result");
      const probs = document.getElementById("probs");

      result.innerHTML = "";
      probs.innerHTML = "";

      if (!inputText) {
        result.innerHTML = "<p style='color: red;'>Please enter some text to analyze.</p>";
        return;
      }

      fetch("/predict", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ tweet: inputText })
      })
      .then(r => r.json())
      .then(data => {
        if (data.error) {
          result.innerHTML = "<p style='color: red;'>" + data.error + "</p>";
          return;
        }

        result.innerHTML = `<p style="font-size:20px; color:${data.color};">${data.result}</p>`;

        // Show probability bars (simple)
        if (data.probabilities && data.classes) {
          const classes = data.classes;
          const probsList = data.probabilities;

          const labels = classes.map((c) => {
            if (c === 0) return "Hate Speech";
            if (c === 1) return "Offensive Language";
            if (c === 2) return "Neither";
            return String(c);
          });

          const maxWidth = 100; // percent
          probs.innerHTML = labels.map((label, i) => {
            const pct = (probsList[i] * 100).toFixed(1);
            return `
              <div style="text-align:left; margin-top:8px;">
                <div style="font-size:14px; margin-bottom:4px;">${label}: ${pct}%</div>
                <div style="height:10px; background:#eee; border-radius:6px;">
                  <div style="height:10px; width:${pct}%; border-radius:6px; background:#999;"></div>
                </div>
              </div>
            `;
          }).join("");
        }
      })
      .catch(err => {
        console.error(err);
        result.innerHTML = "<p style='color: red;'>An error occurred while processing your request.</p>";
      });
    }
  </script>
</body>
</html>
